<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бронирования - Гостиница</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <header>
        <div class="header-container">
            <h1>Гостиница "Престиж"</h1>
            <nav>
                <a href="/">Главная</a>
                <a href="/clients">Клиенты</a>
                <a href="/bookings" class="active">Бронирования</a>
                <a href="/stays">Проживания</a>
                <% if (user) { %>
                    <a href="/profile">Профиль</a>
                    <a href="/auth/logout">Выйти (<%= user.login %>)</a>
                <% } else { %>
                    <a href="/auth/login">Войти</a>
                    <a href="/auth/register">Регистрация</a>
                <% } %>
            </nav>
        </div>
    </header>

    <main>
        <div class="header-actions">
            <h2>Управление бронированиями</h2>
            <% if (user && user.role === 'Администратор') { %>
                <a href="/bookings/add" class="btn btn-primary">Добавить бронирование</a>
            <% } %>
        </div>

        <% if (bookings && bookings.length > 0) { %>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Клиент</th>
                        <th>Номер</th>
                        <th>Дата создания</th>
                        <th>Заезд</th>
                        <th>Выезд</th>
                        <th>Кол-во гостей</th>
                        <th>Статус</th>
                        <th>Стоимость</th>
                        <% if (user && user.role === 'Администратор') { %>
                            <th>Действия</th>
                        <% } %>
                    </tr>
                </thead>
                <tbody>
                    <% bookings.forEach(booking => { %>
                    <tr>
                        <td><%= booking.id %></td>
                        <td>
                            <% if (booking.Client) { %>
                                <%= booking.Client.last_name %> <%= booking.Client.first_name %>
                            <% } else { %>
                                <span style="color: #e74c3c;">Клиент не найден</span>
                            <% } %>
                        </td>
                        <td>
                            <% if (booking.Room) { %>
                                №<%= booking.Room.room_number %> (<%= booking.Room.room_type %>)
                            <% } else { %>
                                <span style="color: #e74c3c;">Номер не найден</span>
                            <% } %>
                        </td>
                        <td><%= new Date(booking.creation_date).toLocaleDateString('ru-RU') %></td>
                        <td><%= new Date(booking.check_in_date).toLocaleDateString('ru-RU') %></td>
                        <td><%= new Date(booking.check_out_date).toLocaleDateString('ru-RU') %></td>
                        <td><%= booking.guests_count || 1 %></td>
                        <td>
                            <span class="status-badge status-<%= booking.status %>">
                                <% 
                                    const statusLabels = {
                                        'pending': 'Ожидание',
                                        'confirmed': 'Подтверждено',
                                        'cancelled': 'Отменено',
                                        'completed': 'Завершено'
                                    };
                                %>
                                <%= statusLabels[booking.status] || booking.status %>
                            </span>
                        </td>
                        <td><%= booking.total_price ? booking.total_price.toLocaleString('ru-RU') + ' ₽' : '—' %></td>
                        <% if (user && user.role === 'Администратор') { %>
                            <td class="actions">
                                <a href="/bookings/edit/<%= booking.id %>" class="btn btn-edit">Изменить</a>
                                <form action="/bookings/delete/<%= booking.id %>" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-delete" onclick="return confirm('Вы уверены, что хотите удалить это бронирование?')">Удалить</button>
                                </form>
                            </td>
                        <% } %>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } else { %>
            <div class="info-box">
                <h3>Бронирования не найдены</h3>
                <p>В системе пока нет активных бронирований.</p>
                <% if (user && user.role === 'Администратор') { %>
                    <a href="/bookings/add" class="btn btn-primary" style="margin-top: 1rem;">Добавить первое бронирование</a>
                <% } %>
            </div>
        <% } %>

        <% if (bookings && bookings.length > 0) { %>
            <div style="margin-top: 1rem; color: #7f8c8d; text-align: center;">
                Найдено бронирований: <strong><%= bookings.length %></strong>
            </div>
        <% } %>
    </main>

    <style>
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-pending { background: #f39c12; color: white; }
        .status-confirmed { background: #27ae60; color: white; }
        .status-cancelled { background: #e74c3c; color: white; }
        .status-completed { background: #3498db; color: white; }
    </style>
</body>
</html>